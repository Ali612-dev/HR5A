<!-- Enhanced Loading State -->
<div *ngIf="isLoading" class="loading-container">
  <div class="loading-content">
    <mat-spinner diameter="60"></mat-spinner>
    <div class="loading-text">
      <h5 class="loading-title">{{ 'Loading' | translate }} {{ 'SalaryReports' | translate }}...</h5>
      <p class="loading-subtitle">{{ 'PleaseWait' | translate }}</p>
    </div>
  </div>
</div>

<!-- Enhanced Error State -->
<div *ngIf="error && !isLoading" class="error-container">
  <div class="error-content">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <div class="error-text">
      <h5 class="error-title">{{ 'Error' | translate }}</h5>
      <p class="error-message">{{ error | translate }}</p>
    </div>
    <div class="error-actions">
      <button mat-raised-button color="warn" (click)="onRetry()">
        <mat-icon>refresh</mat-icon>
        {{ 'Retry' | translate }}
      </button>
    </div>
  </div>
</div>

<!-- Desktop Material Table View -->
<div *ngIf="!isLoading && !error && !isMobile" class="material-table-container">
  <div class="table-wrapper">
    <table mat-table [dataSource]="dataSource" matSort class="material-table">
      
      <!-- Employee Name Column -->
      <ng-container matColumnDef="employeeName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="employeeName" class="text-center">
          {{ 'EmployeeName' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="employee-cell">
          <div class="employee-info">
            <div class="employee-name">{{ report.employeeName }}</div>
            <div class="employee-phone">{{ report.employeePhoneNumber }}</div>
          </div>
        </td>
      </ng-container>

      <!-- Month Column -->
      <ng-container matColumnDef="reportMonth">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="reportMonth" class="text-center">
          {{ 'ReportMonth' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="text-center">{{ report.reportMonth }}</td>
      </ng-container>

      <!-- Year Column -->
      <ng-container matColumnDef="reportYear">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="reportYear" class="text-center">
          {{ 'ReportYear' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="text-center">{{ report.reportYear }}</td>
      </ng-container>

      <!-- Base Salary Column -->
      <ng-container matColumnDef="baseSalary">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="baseSalary" class="text-center">
          {{ 'BaseSalary' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="text-end salary-cell">
          {{ formatCurrency(report.baseSalary) }}
        </td>
      </ng-container>

      <!-- Net Salary Column -->
      <ng-container matColumnDef="netCalculatedSalary">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="netCalculatedSalary" class="text-center">
          {{ 'NetSalary' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="text-end net-salary-cell">
          <span class="net-salary-value">{{ formatCurrency(report.netCalculatedSalary) }}</span>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="isPaid">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="isPaid" class="text-center">
          {{ 'Status' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="text-center">
          <mat-chip [class]="getStatusBadgeClass(report.isPaid)">
            <mat-icon class="chip-icon">{{ report.isPaid ? 'check_circle' : 'cancel' }}</mat-icon>
            {{ getStatusText(report.isPaid) | translate }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Generated Date Column -->
      <ng-container matColumnDef="generatedDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="generatedDate" class="text-center">
          {{ 'GeneratedDate' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="text-center date-cell">
          {{ formatDateTime(report.generatedDate) }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="text-center">
          {{ 'Actions' | translate }}
        </th>
        <td mat-cell *matCellDef="let report" class="text-center actions-cell">
          <div class="action-buttons">
            <button mat-icon-button color="primary" (click)="onView(report)" [title]="'View' | translate">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button color="accent" (click)="onDownload(report)" [title]="'Download' | translate">
              <mat-icon>download</mat-icon>
            </button>
            <button *ngIf="!report.isPaid" mat-icon-button color="primary" (click)="onMarkAsPaid(report)" [title]="'MarkAsPaid' | translate">
              <mat-icon>check_circle</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="onDelete(report)" [title]="'Delete' | translate">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
    </table>
  </div>
</div>

<!-- Mobile/Tablet Card View -->
<div *ngIf="!isLoading && !error && isMobile" class="card-container mobile-cards">
  <mat-card *ngFor="let report of reports; trackBy: trackByFn" class="salary-report-card">
    <!-- Card Header -->
    <mat-card-header>
      <div class="employee-header">
        <div class="employee-info">
          <mat-card-title class="employee-name">{{ report.employeeName }}</mat-card-title>
          <mat-card-subtitle class="employee-id">{{ report.employeePhoneNumber }}</mat-card-subtitle>
        </div>
        <mat-chip [class]="getStatusBadgeClass(report.isPaid)">
          <mat-icon class="chip-icon">{{ report.isPaid ? 'check_circle' : 'cancel' }}</mat-icon>
          {{ getStatusText(report.isPaid) | translate }}
        </mat-chip>
      </div>
    </mat-card-header>

    <!-- Card Body -->
    <mat-card-content>
      <div class="report-details">
        <!-- Salary Information -->
        <div class="salary-section">
          <div class="salary-row">
            <div class="salary-label">{{ 'BaseSalary' | translate }}</div>
            <div class="salary-value">{{ formatCurrency(report.baseSalary) }}</div>
          </div>
          <div class="salary-row net-salary">
            <div class="salary-label">{{ 'NetSalary' | translate }}</div>
            <div class="salary-value net-salary-value">{{ formatCurrency(report.netCalculatedSalary) }}</div>
          </div>
        </div>

        <!-- Report Period -->
        <div class="period-section">
          <div class="period-row">
            <div class="period-label">{{ 'ReportMonth' | translate }}</div>
            <div class="period-value">{{ report.reportMonth }}</div>
          </div>
          <div class="period-row">
            <div class="period-label">{{ 'ReportYear' | translate }}</div>
            <div class="period-value">{{ report.reportYear }}</div>
          </div>
          <div class="period-row">
            <div class="period-label">{{ 'GeneratedDate' | translate }}</div>
            <div class="period-value">{{ formatDateTime(report.generatedDate) }}</div>
          </div>
        </div>
      </div>
    </mat-card-content>

    <!-- Card Footer -->
    <mat-card-actions class="card-actions">
      <button mat-button color="primary" (click)="onView(report)">
        <mat-icon>visibility</mat-icon>
        {{ 'View' | translate }}
      </button>
      <button mat-button color="accent" (click)="onDownload(report)">
        <mat-icon>download</mat-icon>
        {{ 'Download' | translate }}
      </button>
      <button *ngIf="!report.isPaid" mat-button color="primary" (click)="onMarkAsPaid(report)">
        <mat-icon>check_circle</mat-icon>
        {{ 'MarkAsPaid' | translate }}
      </button>
      <button mat-button color="warn" (click)="onDelete(report)">
        <mat-icon>delete</mat-icon>
        {{ 'Delete' | translate }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>

<!-- Enhanced Empty State -->
<div *ngIf="!isLoading && !error && reports.length === 0" class="empty-state">
  <div class="empty-content">
    <mat-icon class="empty-icon">description</mat-icon>
    <div class="empty-text">
      <h4 class="empty-title">{{ 'NoSalaryReports' | translate }}</h4>
      <p class="empty-description">{{ 'NoSalaryReportsDescription' | translate }}</p>
    </div>
    <div class="empty-actions">
      <button mat-raised-button color="primary" (click)="onCreateReport()">
        <mat-icon>add</mat-icon>
        {{ 'CreateFirstReport' | translate }}
      </button>
      <button mat-stroked-button (click)="onRetry()">
        <mat-icon>refresh</mat-icon>
        {{ 'Refresh' | translate }}
      </button>
    </div>
  </div>
</div>
