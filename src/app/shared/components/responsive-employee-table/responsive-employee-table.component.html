
<!-- Shimmer Loading Placeholder -->
<div *ngIf="isLoading">
  <!-- Desktop Shimmer -->
  <div *ngIf="!isMobile" class="table-responsive-wrapper glass-card">
    <div class="shimmer-table">
      <div class="shimmer-row shimmer-header">
        <div class="shimmer-cell"></div>
        <div class="shimmer-cell"></div>
        <div class="shimmer-cell"></div>
        <div class="shimmer-cell"></div>
        <div class="shimmer-cell"></div>
      </div>
      <div class="shimmer-row" *ngFor="let i of [1, 2, 3, 4, 5]">
        <div class="shimmer-cell"><span class="shimmer-line"></span></div>
        <div class="shimmer-cell"><span class="shimmer-line"></span></div>
        <div class="shimmer-cell"><span class="shimmer-line"></span></div>
        <div class="shimmer-cell"><span class="shimmer-line"></span></div>
        <div class="shimmer-cell"><span class="shimmer-line"></span></div>
      </div>
    </div>
  </div>

  <!-- Mobile Shimmer -->
  <div *ngIf="isMobile" class="employee-cards-container">
    <div class="employee-card shimmer-card" *ngFor="let i of [1, 2, 3]">
      <div class="card-header">
        <div class="shimmer-line title"></div>
        <div class="shimmer-line badge"></div>
      </div>
      <div class="card-body">
        <div class="shimmer-line"></div>
        <div class="shimmer-line"></div>
        <div class="shimmer-line"></div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="error">
  <app-error [errorMessage]="error" (retry)="onRetry()"></app-error>
</div>

<!-- Desktop Table View -->
<div *ngIf="!isMobile && !isLoading && !error" class="table-container glass-card table-responsive-wrapper">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th (click)="onSort('id')">
          <input type="checkbox" [checked]="isAllSelected" [indeterminate]="isSomeSelected && !isAllSelected" (change)="onToggleSelection(null)" (click)="$event.stopPropagation()" /> {{ 'FullName' | translate }} <fa-icon [icon]="request.sortField === 'id' ? (request.sortOrder === 'asc' ? faSortUp : faSortDown) : faSort"></fa-icon>
        </th>
        <th (click)="onSort('email')">
          {{ 'Email' | translate }} <fa-icon [icon]="request.sortField === 'email' ? (request.sortOrder === 'asc' ? faSortUp : faSortDown) : faSort"></fa-icon>
        </th>
        <th (click)="onSort('phoneNumber')">
          {{ 'Phone' | translate }} <fa-icon [icon]="request.sortField === 'phoneNumber' ? (request.sortOrder === 'asc' ? faSortUp : faSortDown) : faSort"></fa-icon>
        </th>
        <th (click)="onSort('department')">
          {{ 'Department' | translate }} <fa-icon [icon]="request.sortField === 'department' ? (request.sortOrder === 'asc' ? faSortUp : faSortDown) : faSort"></fa-icon>
        </th>
        <th>{{ 'Actions' | translate }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let employee of employees">
        <td><input type="checkbox" [checked]="employee.selected" (change)="onToggleSelection(employee)" /> {{ employee.name }}</td>
        <td>{{ employee.email }}</td>
        <td>{{ employee.phone }}</td>
        <td>{{ employee.department }}</td>
        <td class="action-cell">
          <div class="dropdown">
            <a class="dropdown-toggle" (click)="toggleDropdown(employee, $event)">
              <fa-icon [icon]="faEllipsisV"></fa-icon>
            </a>
            <div class="dropdown-menu glass-card" [class.show]="employee.showActions">
              <a class="dropdown-item" [routerLink]="['/employees/view', employee.id]"><fa-icon [icon]="faEye"></fa-icon> {{ 'View' | translate }}</a>
              <a class="dropdown-item" [routerLink]="['/employees/update', employee.id]"><fa-icon [icon]="faEdit"></fa-icon> {{ 'Edit' | translate }}</a>
              <a class="dropdown-item" (click)="onDelete(employee)"><fa-icon [icon]="faTrash"></fa-icon> {{ 'Delete' | translate }}</a>
              <a class="dropdown-item" (click)="openMessageDialog(employee)" [class.loading]="isWhatsappLoading(employee.id)">
                <fa-icon [icon]="faWhatsapp" *ngIf="!isWhatsappLoading(employee.id)"></fa-icon>
                <fa-icon [icon]="faSpinner" *ngIf="isWhatsappLoading(employee.id)" class="fa-spin"></fa-icon>
                {{ isWhatsappLoading(employee.id) ? ('Sending...' | translate) : ('SendWhatsApp' | translate) }}
              </a>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  <app-pagination
    [totalCount]="totalCount"
    [request]="request"
    (pageChange)="onPageChange($event)"
  ></app-pagination>
</div>

<!-- Mobile Card View -->
<div *ngIf="isMobile && !isLoading && !error" class="mobile-employee-container">
  <!-- Mobile Select All Header -->
  <div class="mobile-select-all">
    <label class="select-all-checkbox">
      <input type="checkbox" [checked]="isAllSelected" [indeterminate]="isSomeSelected && !isAllSelected" (change)="onToggleSelection(null)" />
      <span>{{ 'SelectAll' | translate }}</span>
    </label>
  </div>

  <!-- Employee Cards -->
  <div class="employee-cards-container">
    <div class="employee-card glass-card" *ngFor="let employee of employees">
      <div class="card-header">
        <div class="employee-checkbox">
          <input type="checkbox" [checked]="employee.selected" (change)="onToggleSelection(employee)" />
        </div>
        <div class="employee-info">
          <h3 class="card-title">{{ employee.name }}</h3>
          <span class="badge" [class.active]="employee.isActive" [class.inactive]="!employee.isActive">
            {{ employee.isActive ? ('Active' | translate) : ('Inactive' | translate) }}
          </span>
        </div>
        <div class="card-actions">
          <div class="dropdown">
            <a class="dropdown-toggle" (click)="toggleDropdown(employee, $event)">
              <fa-icon [icon]="faEllipsisV"></fa-icon>
            </a>
            <div class="dropdown-menu glass-card" [class.show]="employee.showActions">
              <a class="dropdown-item" [routerLink]="['/employees/view', employee.id]"><fa-icon [icon]="faEye"></fa-icon> {{ 'View' | translate }}</a>
              <a class="dropdown-item" [routerLink]="['/employees/update', employee.id]"><fa-icon [icon]="faEdit"></fa-icon> {{ 'Edit' | translate }}</a>
              <a class="dropdown-item" (click)="onDelete(employee)"><fa-icon [icon]="faTrash"></fa-icon> {{ 'Delete' | translate }}</a>
              <a class="dropdown-item" (click)="openMessageDialog(employee)" [class.loading]="isWhatsappLoading(employee.id)">
                <fa-icon [icon]="faWhatsapp" *ngIf="!isWhatsappLoading(employee.id)"></fa-icon>
                <fa-icon [icon]="faSpinner" *ngIf="isWhatsappLoading(employee.id)" class="fa-spin"></fa-icon>
                {{ isWhatsappLoading(employee.id) ? ('Sending...' | translate) : ('SendWhatsApp' | translate) }}
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="info-row">
          <fa-icon [icon]="faEnvelope"></fa-icon>
          <span class="label">{{ 'Email' | translate }}:</span>
          <span class="value">{{ employee.email }}</span>
        </div>
        <div class="info-row">
          <fa-icon [icon]="faPhone"></fa-icon>
          <span class="label">{{ 'Phone' | translate }}:</span>
          <span class="value">{{ employee.phone }}</span>
        </div>
        <div class="info-row">
          <fa-icon [icon]="faBuilding"></fa-icon>
          <span class="label">{{ 'Department' | translate }}:</span>
          <span class="value">{{ employee.department }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Pagination -->
  <app-pagination
    [totalCount]="totalCount"
    [request]="request"
    (pageChange)="onPageChange($event)"
  ></app-pagination>
</div>
