<div class="update-attendance-container">
  <div class="container-fluid">
    <!-- Header Section -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="page-title">
            <fa-icon [icon]="faEdit" class="title-icon"></fa-icon>
            {{ 'UpdateAttendance' | translate }}
          </h1>
          <p class="page-subtitle">{{ 'UpdateAttendanceRecord' | translate }}</p>
        </div>
        <div class="header-actions">
          <button type="button" class="btn btn-ghost" (click)="onCancel()">
            <fa-icon [icon]="faArrowLeft" class="me-2"></fa-icon>
            {{ 'Back' | translate }}
          </button>
        </div>
      </div>
    </div>

    <!-- Main Form Card -->
    <div class="form-card">
      <div *ngIf="store.isLoading()" class="loading-container">
        <div class="loading-spinner">
          <fa-icon [icon]="faSpinner" class="fa-spin"></fa-icon>
        </div>
        <p class="loading-text">{{ 'Loading' | translate }}...</p>
      </div>

      <div *ngIf="!store.isLoading()" class="form-content">
        <form [formGroup]="attendanceForm" (ngSubmit)="onSubmit()" class="attendance-form">
          
          <!-- Employee Search Section -->
          <div class="form-section">
            <div class="section-header">
              <h3 class="section-title">
                <fa-icon [icon]="faUser" class="section-icon"></fa-icon>
                {{ 'EmployeeInformation' | translate }}
              </h3>
            </div>
            <div class="form-row">
              <div class="form-field">
                <label for="employeeSearch" class="field-label">
                  <fa-icon [icon]="faSearch" class="label-icon"></fa-icon>
                  {{ 'EmployeeNameOrPhone' | translate }}
                </label>
                <div class="input-container">
                  <input 
                    type="text" 
                    class="modern-input"
                    id="employeeSearch" 
                    [formControl]="employeeSearchTerm" 
                    [placeholder]="'SearchEmployee' | translate"
                    (blur)="onEmployeeSearchBlur()"
                  >
                  <div *ngIf="suggestions.length > 0" class="autocomplete-dropdown">
                    <div *ngFor="let suggestion of suggestions" 
                         class="suggestion-item" 
                         (click)="selectEmployee(suggestion)">
                      {{ suggestion.name }} ({{ suggestion.phone }})
                    </div>
                  </div>
                  <div *ngIf="getValidationErrors('employeeSearchTerm').length > 0 && !selectedEmployeeId" 
                       class="error-message">
                    <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
                    <span *ngFor="let error of getValidationErrors('employeeSearchTerm')">{{ error }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Date & Time Section -->
          <div class="form-section">
            <div class="section-header">
              <h3 class="section-title">
                <fa-icon [icon]="faClock" class="section-icon"></fa-icon>
                {{ 'DateTimeInformation' | translate }}
              </h3>
            </div>
            <div class="form-row">
              <div class="form-field">
                <label for="date" class="field-label">
                  <fa-icon [icon]="faCalendarAlt" class="label-icon"></fa-icon>
                  {{ 'Date' | translate }}
                </label>
                <div class="input-container">
                  <input 
                    type="date" 
                    class="modern-input" 
                    id="date" 
                    formControlName="date"
                    [disabled]="true">
                  <div *ngIf="getValidationErrors('date').length > 0" class="error-message">
                    <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
                    <span *ngFor="let error of getValidationErrors('date')">{{ error }}</span>
                  </div>
                </div>
              </div>
              <div class="form-field">
                <label for="timeIn" class="field-label">
                  <fa-icon [icon]="faSignInAlt" class="label-icon"></fa-icon>
                  {{ 'TimeIn' | translate }}
                </label>
                <div class="input-container">
                  <input 
                    type="time" 
                    class="modern-input" 
                    id="timeIn" 
                    formControlName="timeIn">
                  <div *ngIf="getValidationErrors('timeIn').length > 0" class="error-message">
                    <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
                    <span *ngFor="let error of getValidationErrors('timeIn')">{{ error }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="form-field">
                <label for="timeOut" class="field-label">
                  <fa-icon [icon]="faSignOutAlt" class="label-icon"></fa-icon>
                  {{ 'TimeOut' | translate }}
                </label>
                <div class="input-container">
                  <input 
                    type="time" 
                    class="modern-input" 
                    id="timeOut" 
                    formControlName="timeOut">
                  <div *ngIf="getValidationErrors('timeOut').length > 0" class="error-message">
                    <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
                    <span *ngFor="let error of getValidationErrors('timeOut')">{{ error }}</span>
                  </div>
                </div>
              </div>
              <div class="form-field">
                <label for="time" class="field-label">
                  <fa-icon [icon]="faClock" class="label-icon"></fa-icon>
                  {{ 'Time' | translate }}
                </label>
                <div class="input-container">
                  <input 
                    type="time" 
                    class="modern-input" 
                    id="time" 
                    formControlName="time">
                  <div *ngIf="getValidationErrors('time').length > 0" class="error-message">
                    <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
                    <span *ngFor="let error of getValidationErrors('time')">{{ error | translate }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Information Section -->
          <div class="form-section">
            <div class="section-header">
              <h3 class="section-title">
                <fa-icon [icon]="faInfoCircle" class="section-icon"></fa-icon>
                {{ 'AdditionalInformation' | translate }}
              </h3>
            </div>
            <div class="form-row">
              <div class="form-field">
                <label for="locationName" class="field-label">
                  <fa-icon [icon]="faMapMarkerAlt" class="label-icon"></fa-icon>
                  {{ 'LocationName' | translate }}
                </label>
                <div class="input-container">
                  <input 
                    type="text" 
                    class="modern-input" 
                    id="locationName" 
                    formControlName="locationName"
                    [placeholder]="'EnterLocation' | translate">
                </div>
              </div>
              <div class="form-field">
                <label for="status" class="field-label">
                  <fa-icon [icon]="faCheckCircle" class="label-icon"></fa-icon>
                  {{ 'Status' | translate }}
                </label>
                <div class="input-container">
                  <input 
                    type="text" 
                    class="modern-input" 
                    id="status" 
                    formControlName="status">
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="form-field">
                <label for="attType" class="field-label">
                  <fa-icon [icon]="faList" class="label-icon"></fa-icon>
                  {{ 'AttType' | translate }}
                </label>
                <div class="input-container">
                  <app-custom-dropdown
                    [options]="attTypeOptions"
                    [selectedValue]="attendanceForm.get('attType')?.value"
                    (selectionChange)="onAttTypeChange($event)"
                    class="modern-dropdown">
                  </app-custom-dropdown>
                  <div *ngIf="getValidationErrors('attType').length > 0" class="error-message">
                    <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
                    <span *ngFor="let error of getValidationErrors('attType')">{{ error }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions">
            <button type="button" class="btn btn-cancel" (click)="onCancel()">
              <fa-icon [icon]="faTimes" class="me-2"></fa-icon>
              {{ 'Cancel' | translate }}
            </button>
            <button type="submit" class="btn btn-submit" [disabled]="store.isLoading()">
              <fa-icon *ngIf="!store.isLoading()" [icon]="faSave" class="me-2"></fa-icon>
              <fa-icon *ngIf="store.isLoading()" [icon]="faSpinner" class="fa-spin me-2"></fa-icon>
              {{ store.isLoading() ? ('Saving' | translate) : ('Save' | translate) }}
            </button>
          </div>

          <!-- Error Alert -->
          <div *ngIf="store.error()" class="error-alert">
            <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
            <span>{{ store.error()! | translate }}</span>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>