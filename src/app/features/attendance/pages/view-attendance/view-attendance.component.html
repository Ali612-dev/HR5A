<div class="view-attendance-container">
  <div class="container-fluid py-4">
    <!-- Header -->
    <div class="page-header">
      <a routerLink="/attendance" class="back-button">
        <fa-icon [icon]="faArrowLeft"></fa-icon>
      </a>
    </div>

    <!-- Attendance Details -->
    <div class="card">
      <div *ngIf="store.isLoading()">
        <app-shimmer></app-shimmer>
      </div>
      <div *ngIf="store.error()">
        <app-error [errorMessage]="store.error()!" (retry)="onRetry()"></app-error>
      </div>
      <div *ngIf="!store.isLoading() && store.attendance() as attendance">
        <div class="attendance-header">
          <fa-icon [icon]="faUserCircle" class="attendance-avatar"></fa-icon>
          <h2 class="attendance-name">{{ attendance.employeeName }}</h2>
          <div class="status-badge" [ngClass]="attendance.status === 'Present' ? 'active' : 'inactive'">
            {{ attendance.status }}
          </div>
        </div>

        <div class="details-grid" *ngIf="!attendance.sessions || attendance.sessions.length <= 1">
          <div class="detail-item">
            <fa-icon [icon]="faCalendarAlt" class="detail-icon"></fa-icon>
            <div class="detail-content">
              <span class="label">{{ 'Date' | translate }}</span>
              <span class="value">{{ attendance.date | date: 'longDate' }}</span>
            </div>
          </div>
          <div class="detail-item">
            <fa-icon [icon]="faClock" class="detail-icon"></fa-icon>
            <div class="detail-content">
              <span class="label">{{ 'TimeIn' | translate }}</span>
              <span class="value">{{ (attendance.timeIn || attendance.firstCheckIn) | date: 'shortTime' }}</span>
            </div>
          </div>
          <div class="detail-item">
            <fa-icon [icon]="faClock" class="detail-icon"></fa-icon>
            <div class="detail-content">
              <span class="label">{{ 'TimeOut' | translate }}</span>
              <span class="value">{{ (attendance.timeOut || attendance.lastCheckOut) | date: 'shortTime' }}</span>
            </div>
          </div>
          <div class="detail-item" *ngIf="attendance.locationName">
            <fa-icon [icon]="faLocationDot" class="detail-icon"></fa-icon>
            <div class="detail-content">
              <span class="label">{{ 'Location' | translate }}</span>
              <span class="value">{{ attendance.locationName }}</span>
            </div>
          </div>
          <div class="detail-item">
            <fa-icon [icon]="faIdCard" class="detail-icon"></fa-icon>
            <div class="detail-content">
              <span class="label">{{ 'AttendanceType' | translate }}</span>
              <span class="value">{{ attendance.attType || '-' }}</span>
            </div>
          </div>
          <div class="detail-item" *ngIf="attendance.totalWorkedHours">
            <fa-icon [icon]="faClock" class="detail-icon"></fa-icon>
            <div class="detail-content">
              <span class="label">{{ 'TotalHours' | translate }}</span>
              <span class="value success-value">{{ formatHoursToHHMM(attendance.totalWorkedHours) }}</span>
            </div>
          </div>
        </div>

        <!-- Grouped Sessions View -->
        <div class="grouped-sessions-view" *ngIf="attendance.sessions && attendance.sessions.length > 1">
          <div class="section-header mb-3">
            <h3>{{ 'AttendanceSessions' | translate }}</h3>
            <span class="sessions-count">{{ attendance.sessions.length }} {{ 'Sessions' | translate }}</span>
          </div>

          <div class="sessions-list-view">
            <div *ngFor="let session of attendance.sessions; let i = index" class="session-card-horizontal">
              <div class="session-index">#{{ i + 1 }}</div>
              <div class="session-details-horizontal">
                <div class="time-box">
                  <div class="time-label">{{ 'TimeIn' | translate }}</div>
                  <div class="time-value">{{ session.timeIn | date: 'hh:mm:ss a' }}</div>
                </div>
                <div class="time-box">
                  <div class="time-label">{{ 'TimeOut' | translate }}</div>
                  <div class="time-value">{{ (session.timeOut | date: 'hh:mm:ss a') || '-' }}</div>
                </div>
                <div class="time-box">
                  <div class="time-label">{{ 'Hours' | translate }}</div>
                  <div class="time-value">{{ formatHoursToHHMM(session.hours) }}</div>
                </div>
                <div class="location-box" *ngIf="session.locationName">
                  <fa-icon [icon]="faLocationDot"></fa-icon>
                  <span>{{ session.locationName }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="total-summary-horizontal mt-4">
            <div class="summary-box">
              <span class="label">{{ 'TotalHours' | translate }}:</span>
              <span class="value">{{ formatHoursToHHMM(attendance.totalWorkedHours) }}</span>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-4">
          <button class="btn glass-button" [routerLink]="['/attendance/history', attendance.employeeId]">
            {{ 'ViewHistory' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>